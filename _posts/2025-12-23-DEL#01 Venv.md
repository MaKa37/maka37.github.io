---
title: "DEL#01: Virtual Env"
description: "데이터 엔지니어 학습: 가상환경 구축"
layout: single
categories: [DataEngineer, Learning]
author_profile: true

toc: true
toc_icon: "heart"
toc_label: "Contents"
toc_sticky: True
---

***

# 파이썬 기반 및 엔지니어링 환경(Fundamentals)

## Chapter 01: 현대적 Python 환경 구성 및 의존성 관리
- 여러 개의 파이썬을 한 개의 운영체재에 설치 시 충돌이 발생할 수 있다.
- 환경 충돌을 방지하기 위해 재현 가능한 개발 환경을 구축하는 방법을 학습하자.
- `pyenv`, `poetry`를 활용한 프로젝트별 가상환경 격리 및 라이브러리 버전 관리.

### 1. 가상환경 구축

데이터 파이프라인의 핵심 도구들(Airflow, Kafka, Spark 등)은 기본적으로 리눅스 환경을 상정하고 개발되었기 때문입니다.
윈도우 네이티브 환경에서는 호환성 문제가 자주 발생하므로, 실무 환경과 가장 유사한 리눅스 기반으로 학습하는 것이 좋습니다.

#### 윈도우 내 리눅스 환경 구축(WSL)

| **구분**    | **WSL2 (추천)**          | **Virtual Machine (VirtualBox, ETC)** |
| --------- | ---------------------- | ------------------------------------- |
| **성능**    | 윈도우 커널과 직접 통신하여 매우 빠름  | 하드웨어를 에뮬레이트하므로 무겁고 느림                 |
| **자원 관리** | 필요할 때만 메모리 점유          | 미리 할당한 메모리를 항상 점유                     |
| **사용성**   | VS Code 등 윈도우 툴과 완벽 연동 | 별도의 창에서 독립적으로 구동                      |

1. W2L2 구축
2. pyenv: 파이썬 버전 관리
3. poetry: 의존성 및 가상환경 관리

```Bash
# Step 1: Window 운영체재 기준 WSL2 및 Ubuntu 자동 설치 방법

# 명령 프롬포트(CMD) 또는 PowerShell을 관리자 권한으로 실행 후 아래 명령어 입력
# WSL 기능 활성화 및 최신 리눅스 커널을 다운로드하며, 기본 배포판 Ubuntu 자동 설치 명령어
wsl --install

# 시스템 재부팅 후 자동으로 Ubuntu 실행 됨.(실행 안될 시 "찾기"로 Ubuntu 검색 및 실행)
# Enter new UNIX username: 사용할 임의의 아이디를 입력합니다.
# New password: 사용할 임의의 비밀번호를 입력합니다.
```
![1](/images/2025-12-23/1.png)
![2](/images/2025-12-23/2.png)

```Bash
# Step 1: Window 운영체재 기준 WSL2 및 Ubuntu 자동 설치 방법
# WSL 버전 확인 및 최적화(PowerShell 또는 CMD에서 입력 !)
wsl -l -v
wsl --set-version Ubuntu 2
```

![3](/images/2025-12-23/3.png)

#### WSL 가상환경 > Ubuntu > pyenv 설치

```Bash
# Step 2: pyenv 설치 및 파이썬 빌드(필수 패키지 설치)
# WSL2 Ubuntu 터미널에서 필요한 의존성을 먼저 설치 후 pyenv를 설치
# 터미널에 붙여넣기 = 내용 복사 후 터미널에 마우스 우클릭
sudo apt-get update
sudo apt-get install -y make build-essential libssl-dev zlib1g-dev \
libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm \
libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev

# pyenv 설치 (자동 설치 스크립트 이용)
curl https://pyenv.run | bash

# pyenv 환경 설정(시스템이 인식하도록 설정 파일(.bashrc)에 등록)
# pyenv를 시스템이 인식하도록 설정 파일(.bashrc)에 등록
echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc
echo 'command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc
echo 'eval "$(pyenv init -)"' >> ~/.bashrc

# 변경사항 적용
source ~/.bashrc
```

```Bash
# Step 3: Python 3.10.13 설치 후 Poetry 설치 및 설정
# python 설치 후 전역 설정
pyenv install 3.10.13
pyenv global 3.10.13
python --version

# Poetry 설치
curl -sSL https://install.python-poetry.org | python3 -

# Poetry 경로 등록 (보통 자동으로 되지만 안 될 경우 대비)
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc

# 가상환경을 프로젝트 폴더 내부에 생성하도록 설정 (관리 편의성)
poetry config virtualenvs.in-project true

# Poetry 삭제 명령어(pyenv > python > poetry 순으로 설치하지 않았을 경우 참고)
curl -sSL https://install.python-poetry.org | python3 - --uninstall
```

```Bash
# Step 4: pyenv 핵심 명령어 숙달하기.
pyenv install --list

# 특정 파이썬 버전 설치 / 설치 버전 확인(현재 사용중인 버전은 '*' 표기 되있다.) 
pyenv install 3.10.13
pyenv install 3.11.5
pyenv versions

# 전역(Global), 지역(Local) 버전 설정
pyenv global 3.10.13
pyenv local 3.11.5
```
![4](/images/2025-12-23/4.png)

#### 가상환경 구축 실습

데이터 엔지니어링의 경우 각 버전의 성능과 안전성 차이로
버전을 다르게 나누어 사용하는 상황이 빈번하게 발생합니다.

프로젝트 A와 B가 있는데 A의 경우 구형 라이브러리를 사용하여 `3.10` 버전을 사용하고
프로젝트 B의 경우 성능 때문에 `3.11` 버전을 사용하는 경우가 있어 구현 해보겠습니다.

```Bash
# Step 4: pyenv 핵심 명령어 숙달하기.
pyenv install --list

# 특정 파이썬 버전 설치 / 설치 버전 확인 / 전역(Global), 지역(Local) 버전 설정
pyenv install --list # 설치 가능한 리스트 체크
pyenv install 3.10.13
pyenv install 3.11.5 # 삭제 시 install ↔ uninstall
pyenv versions # 설치 되어있는 파이썬 버전 확인

pyenv global 3.10.13 # 시스템 전체에서 사용할 기본 파이썬 버전 설정(전역 설정)
pyenv local 3.11.5 # 현재 폴더(프로젝트)에서 사용할 파이썬 버전 설정(지역 설정)
pyenv which python # 현재 활성화된 파이썬 실행 파일의 실제 경로 확인

# poetry 관련 명령어
poetry init # 기존 폴더를 Poetry 프로젝트로 초기화(pyproject.toml 생성)
poetry add <package> # ex: poetry add pandas
poetry add <package> --group dev # 개발 환경에서만 필요한 도구 별도 관리할 경우
poetry remove <package>

poetry run <command> # 가상환경에 진입하지 않고도 가상환경 명령어 실행(ex: poetry run python main.py)
poetry env info # 현재 사용중인 가상환경의 경로와 파이썬 버전 정보를 상세히 보여줍니다.

# poetry 의존성 동기화
poetry install # pyproject.toml과 poetry.lock 파일을 읽어 필요한 모든 라이브러리를 한 번에 설치합니다.
poetry lock # 라이브러리 간의 버전 충돌을 계산하여 `poetry.lock` 파일을 최신화합니다(실제 설치는 하지 않음).
poetry update # 설치된 라이브러리들을 허용된 범위 내에서 최신 버전으로 업데이트합니다.

# 가상환경 실행 및 관리
source .venv/bin/activate # 생성된 가상환경 활성화
exit # 터미널 종료
deactivate # 가상환경 비활성화

# 실습 A: Python 3.10 기반 프로젝트
mkdir ~/project_a && cd ~/project_a # 디렉터리 생성 및 현재 디렉터리 변경
pyenv local 3.10.13 # 파이썬 버전 고정
poetry init # (엔터를 눌러서 기본 값 설정하기 / 설정 권장 값 확인 必)
poetry add pandas # 라이브러리 설치(pandas)

# 실습 B: Python 3.11 기반 프로젝트
cd ~ # Home 디렉터리로 이동
mkdir project_b && cd project_b
pyenv local 3.11.5 
python --version # 버전 확인(* 3.11.5)

# 질문 생략 및 기본값을 초기화 후 라이브러리 설치
poetry init -n
poetry add requests
pip list | grep pandas # Pandas 설치 여부 확인(Project_A)
pip list | grep request # Requests 설치 여부 확인(Project_B)
```
